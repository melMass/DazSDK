<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="expires" content="0">
<title>DAZ Studio SDK: Compiling DAZ Studio Plugins on Windows</title>
<link href="tabs.css" rel="stylesheet" type="text/css">
<link href="docstyle.css" rel="stylesheet" type="text/css">
</head>
<body>
<!-- Generated by Doxygen 1.7.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<h1>Compiling DAZ Studio Plugins on Windows </h1>  </div>
</div>
<div class="contents">
<p>The DAZ Studio SDK Samples package includes <a href="https://cmake.org" target="_blank">CMake</a> configuration files that are used to generate solution/project files for use with the Microsoft Visual Studio (2010+) IDE. Other development environments may also work for compiling DAZ Studio plugins, however, other IDEs are not officially supported by Daz 3D for the Win32 and Win64 environments. If you do choose to use another development environment, you will likely need to adjust the way your particular compiler finds/names symbols in order to link against the DAZ Studio libraries.</p>
<p>While the exact version of the Microsoft Visual Studio IDE used to develop a DAZ Studio plugin can vary (VS 2017 is being used internally at the time of this writing), the application itself is compiled with the Microsoft Visual C++ 2010 (v100) compiler. This is an important detail because it means that in order to avoid compatibility issues with the allocation and/or freeing of memory, any code that is intended to communicate directly with the application must also be compiled with the same compiler. That being said, it is possible for a plugin to act as a "shim" and marshal data between the application and an another library/engine that is compiled with a compiler other than the Microsoft Visual C++ 2010 compiler.</p>
<h3>Prerequisites:</h3>
<ul>
<li><a href="https://cmake.org/download/" target="_blank">CMake</a> (3.10+)</li>
<li>Microsoft Visual C++ 2010 (v100) compiler<ul>
<li>Included with Microsoft Visual Studio 2010 Professional*</li>
<li>Can also use Microsoft Visual Studio 2010 Express**</li>
</ul>
</li>
</ul>
<p><b>* To use Visual Studio 2010 Professional:</b></p>
<ol type="1">
<li>Download and install <a href="https://www.visualstudio.com/vs/older-downloads/" target="_blank">Visual Studio 2010 Professional</a> from Microsoft (requires login)</li>
<li>Download and install <a href="https://www.visualstudio.com/vs/older-downloads/" target="_blank">Visual Studio Studio 2010 SP1</a> from Microsoft (requires login)</li>
</ol>
<p><b>** To use Visual Studio 2010 Express:</b></p>
<ol type="1">
<li>Download and install <a href="https://www.visualstudio.com/vs/older-downloads/" target="_blank">Visual Studio 2010 Express</a> from Microsoft (requires login)<ul>
<li><b>Microsoft Visual C++ 2010 Express</b></li>
</ul>
</li>
<li>Download and install <a href="https://www.visualstudio.com/vs/older-downloads/" target="_blank">Visual Studio Studio 2010 SP1</a> from Microsoft (requires login)</li>
<li>Download and install <a href="https://www.microsoft.com/en-us/download/details.aspx?id=8442" target="_blank">Microsoft Windows SDK for Windows 7 and .NET Framework 4 (ISO)</a><ul>
<li><b>GRMSDKX_EN_DVD.iso</b> (x64) or <b>GRMSDK_EN_DVD.iso</b> (x86)<ul>
<li>After mounting the image, execute <b>&lt;drive_letter&gt;:\Setup\SDKSetup.exe</b></li>
</ul>
</li>
</ul>
</li>
<li>Download and install <a href="https://www.microsoft.com/en-us/download/details.aspx?id=4422" target="_blank">Microsoft Visual C++ 2010 Service Pack 1 Compiler Update for the Windows SDK 7.1</a></li>
</ol>
<p>&nbsp;</p>
<h2>Generating Microsoft Visual Studio solution/project files:</h2>
<p><b>Note:</b> <em>In the descriptions that follow, <b><em><a href="../" target="_blank">install_dir</a></em></b> is used to mean the path of the "DAZ Studio &lt;version&gt; SDK" folder within the folder that you installed the SDK to. The instructions below describe the steps to build 64-bit versions of a plugin. To build 32-bit versions, substitute "64" with "32" and "Visual Studio 10 2010 Win64" with "Visual Studio 10
	2010" where appropriate. If you would like to generate solution/project files for a newer version of Visual Studio, substitute "10 2010" for the desired version and bit-architecture.</em></p>
<h3>Included Samples:</h3>
<ol type="1">
<li>Create a directory named <b>build</b> within <b><em><a href="../" target="_blank">install_dir</a></em></b></li>
<li>Create a directory named <b>64</b> within <b><em><a href="../build" target="_blank">install_dir\build</a></em></b></li>
<li>Launch CMake</li>
<li>Use the <b>Browse Source...</b> button to select <b><em><a href="../" target="_blank">install_dir</a></em></b></li>
<li>Use the <b>Browse Build...</b> button to select <b><em><a href="../build/64" target="_blank">install_dir\build\64</a></em></b></li>
<li>Click the <b>Configure</b> button<ol type="a">
<li>Select <b>Visual Studio 10 2010 Win64</b> for the generator</li>
<li>Enter <b>v100</b> for the optional toolset<ul>
<li>This causes the Microsoft Visual C++ 2010 compiler to be used</li>
</ul>
</li>
<li>Click the <b>Finish</b> button<ul>
<li>It may take a little while to process</li>
</ul>
</li>
</ol>
</li>
<li>Enter the path to the <b>DAZ_STUDIO_EXE_DIR</b>, under the <b>Value</b> column*** <em>(optional)</em><ul>
<li>Use the <b>...</b> button to select the installation directory of your Daz Studio installation</li>
<li>Whether or not you can successfully use this option depends on the permissions of your Daz Studio installation path<ul>
<li>If this path is protected (e.g., C:\Program Files...) this will likely fail</li>
</ul>
</li>
</ul>
</li>
<li>Click the <b>Generate</b> button</li>
<li>Close CMake</li>
<li>Open the generated <b><em><a href="../build/64/DAZ Studio SDK.sln" target="_blank">install_dir\build\64\DAZ Studio SDK.sln</a></em></b> file in Visual Studio.</li>
</ol>
<p>&nbsp;</p>
<h3>Adding Your Own Plugins:</h3>
<ol type="1">
<li>Create a directory named <b>My Plugins</b> within <b><em><a href="../" target="_blank">install_dir</a></em></b>, as a sibling to the <b>samples</b> directory</li>
<li>Edit the <b><em><a href="../CMakeLists.txt" target="_blank">CMakeLists.txt</a></em></b> file in the <b><em><a href="../" target="_blank">install_dir</a></em></b> directory<ol type="a">
<li>Uncomment the <code>#add_subdirectory("My Plugins")</code> line directly below <code>add_subdirectory(samples)</code>, near the bottom</li>
</ol>
</li>
<li>Copy the <b>CMakeLists.txt</b> file in the <b><em><a href="../samples" target="_blank">install_dir\samples</a></em></b> directory to the <b><em><a href="../My Plugins" target="_blank">install_dir\My Plugins</a></em></b> directory</li>
<li>Create a directory named <b>plugin_name</b> within <b><em><a href="../My Plugins" target="_blank">install_dir\My Plugins</a></em></b></li>
<li>Edit the <b><em><a href="../My Plugins/CMakeLists.txt" target="_blank">CMakeLists.txt</a></em></b> file in the <b><em><a href="../My Plugins" target="_blank">install_dir\My Plugins</a></em></b> directory<ol type="a">
<li>Comment (or remove) each of the <code>add_subdirectory(&lt;folder_name&gt;)</code> statements except for one</li>
<li>Replace the remaining <code>add_subdirectory(&lt;folder_name&gt;)</code> with <code>add_subdirectory(plugin_name)</code><ul>
<li>If <b>plugin_name</b> contains spaces, enclose it in quotes</li>
</ul>
</li>
</ol>
</li>
<li>Copy the contents of the <b><em><a href="../samples/interface/AFirstPlugin" target="_blank">install_dir\samples\interface\AFirstPlugin</a></em></b> directory to the <b><em><a href="../My Plugins/plugin_name" target="_blank">install_dir\My Plugins\plugin_name</a></em></b> directory</li>
<li>Edit the <b><em><a href="../My Plugins/plugin_name/CMakeLists.txt" target="_blank">CMakeLists.txt</a></em></b> file in the <b><em><a href="../My Plugins/plugin_name" target="_blank">install_dir\My Plugins\plugin_name</a></em></b> directory<ol type="a">
<li>Rename the <code>sdk_afirstplugin</code> value in the <code>set(DZ_PLUGIN_TGT_NAME sdk_afirstplugin)</code> line near the top to the basename of the .dll for your plugin</li>
<li>Rename the <code>"A First Plugin"</code> value in the <code>set(DZ_PLUGIN_PROJECT_NAME "A First Plugin")</code> line below it to the title of your plugin</li>
<li>Replace occurrences of <code>SDK Samples</code> with <code>My Plugins</code></li>
</ol>
</li>
<li>Repeat steps 3-10 in the <b>Included Samples</b> section above<ul>
<li>Sub-steps will not be necessary to repeat</li>
</ul>
</li>
</ol>
<p>&nbsp;</p>
<h2>Other Considerations:</h2>
<p>If you choose to forego using the provided CMake configuration files, there are several things you must be aware of and account for when building your solution/project files.</p>
<h3>Preprocessor Definitions:</h3>
<p>On Windows, one of the following symbols must be defined in the compiler for 32-bit DAZ Studio plugins to correctly compile: WIN32, _WIN32, or __WIN32__. By default, Visual C++ 2010 defines the WIN32 symbol for new Win32 projects. No other preprocessor definitions are required for compiling 32-bit DAZ Studio plugins.</p>
<p>For 64-bit DAZ Studio plugins one of the following symbols must be defined: WIN64, __WIN64, or __WIN64__. By default, Visual Studio C++ 2010 defines the __WIN64 symbol for new x64 projects. No other preprocessor definitions are required for compiling 64-bit DAZ Studio plugins.</p>
<p>&nbsp;</p>
<h3>Include Directories:</h3>
<p>All of the header files necessary for using the DAZ Studio SDK can be found in the <b><em><a href="../include" target="_blank">install_dir\include</a></em></b> folder. You will need to add this folder to the include paths for your plugin in order to use the DAZ Studio SDK.</p>
<p>&nbsp;</p>
<h3>Library Directories:</h3>
<p>All of the *.lib files necessary for linking against the DAZ Studio SDK can be found in the <b><em><a href="../lib" target="_blank">install_dir\lib</a></em></b> folder; Win32 for 32-bit plugins, x64 for 64-bit plugins. You will need to add this folder to the library paths for your plugin in order to use the DAZ Studio SDK.</p>
<p>&nbsp;</p>
<h3>Binary Directories:</h3>
<p>Executable and *.dll files needed when using the DAZ Studio SDK can be found in the <b><em><a href="../bin" target="_blank">install_dir\bin</a></em></b> folder; Win32 for 32-bit plugins, x64 for 64-bit plugins. You may need to add this folder to the paths that your IDE uses for finding executable files used during a build step.</p>
<p>&nbsp;</p>
<h3>The MOC (Meta-Object Compiler) pre-compiler:</h3>
<p>The DAZ Studio SDK relies on a custom pre-compiler to generate source for the Run-Time Type Information (RTTI) that the plugin architecture relies on. If you have never used a pre-compiler in your build process before, this step will be new to you, but it should not be too difficult. The pre-compiler is the <b>moc.exe</b> executable that can be found in the <b><em><a href="../bin/Win32" target="_blank">install_dir\bin\Win32</a></em></b> folder; Win32 for 32-bit plugins, x64 for 64-bit plugins. The 'moc' utility takes 2 parameters; the path of the source file and the path of the output file. The source file will typically be a *.h file, though *.cpp files can also be "moc'ed". The output should typically be given a *.cpp extension. You can execute 'moc' with a command such as this: <b>moc myclass.h -o myclass_moc.cpp</b>, where <b>myclass.h</b> is the source file, and <b>myclass_moc.cpp</b> is the output file generated by the moc tool. Moc can be run from the command line using the example given above, however, this is cumbersome; every time the source file changes, it must be run through the pre-compiler again. Most developers will find that the easiest way to run moc is to make it a part of the build process by creating a Custom Build Step for the source files in their project settings.</p>
<p>In Visual C++ 2010, for example, in the Solution Explorer, you would right click on the myclass.h file, and select <b>Properties</b>. Then, select <b>All Configurations</b> in the <b>Configurations</b> combo so that the build step is applied for debug and release builds. Then select the <b>Custom Build Step</b> settings. For the <b>Command Line</b> setting, you would enter the command that executes the moc tool, for example "C:\\DAZ Studio SDK\\bin\\x64\\moc myclass.h -o
	myclass_moc.cpp" then in the <b>Outputs</b> setting, you would put the output file <b>myclass_moc.cpp</b> so that the compiler knows when the output is outdated, and can automatically perform the build step again. That's it, now just click <b>Ok</b> and build your project; the <b>myclass_moc.cpp</b> file should be created in your project directory. The last thing that needs to be done is to make sure that the output file is compiled with the rest of the project. The easiest way to do this is to simply add the output file to your project. Another option is to include it from another source file in your project with a statement like <b>include &lt;myclass_moc.cpp&gt;</b>.</p>
<p>For a brief description of moc and its options, pull up a command prompt and run <code>moc -help</code>;</p>
<p>&nbsp;</p>
<h3>When to use MOC (and when not to):</h3>
<p>Not all files for a DAZ Studio plugin need to be processed by the precompiler. Only files which declare <a class="el" href="class_dz_base.html" title="Base class for a considerable portion of the Daz Studio API.">DzBase</a> (or QObject) derived classes need to be moc'ed; if your source file uses the 'Q_OBJECT' macro anywhere, then it needs to be moc'ed. Otherwise, the precompiler step is unnecessary. See the example plugins included in the SDK to see how the 'moc' build step is set up. </p>
</div>
<hr size="1">
<address style="align: right;">
<small> Generated on Sun Feb 9 2020 01:35:17</small>
</address>
<h3 align="center">Copyright &copy; 2002 - 2020 DAZ 3D, Inc.</h3>
</body>
</html>
