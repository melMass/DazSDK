<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="expires" content="0">
<title>DAZ Studio SDK: Compiling DAZ Studio Plugins on macOS (Mac OS X / OS X)</title>
<link href="tabs.css" rel="stylesheet" type="text/css">
<link href="docstyle.css" rel="stylesheet" type="text/css">
</head>
<body>
<!-- Generated by Doxygen 1.7.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<h1>Compiling DAZ Studio Plugins on macOS (Mac OS X / OS X) </h1>  </div>
</div>
<div class="contents">
<p>The DAZ Studio SDK Samples package includes <a href="https://cmake.org" target="_blank">CMake</a> configuration files that are used to generate a project file for use with the Apple Xcode IDE. Other development environments may also work for compiling DAZ Studio plugins, however, other IDEs are not officially supported by Daz 3D for macOS. If you do choose to use another development environment, you will likely need to adjust the way your particular compiler finds/names symbols in order to link against the DAZ Studio libraries.</p>
<p>While the exact version of the Apple Xcode IDE used to develop a DAZ Studio plugin can vary (Xcode 3.2.6, running on Mac OS X 10.6.8, is being used internally), the application itself is compiled with GCC 4.2. More importantly, the application is linked against <b>libstdc++.6.dylib</b>. This is an important detail because it means that in order to avoid compatibility issues with the allocation and/or freeing of memory, any code that is intended to communicate directly with the application must also be linked against <b>libstdc++.6.dylib</b>; regardless of whether you use the GCC compiler or the Clang (LLVM) compiler. That being said, it is possible for a plugin to act as a "shim" and marshal data between the application and another library/engine that is linked against a library other than <b>libstdc++.6.dylib</b>.</p>
<h3>Prerequisites:</h3>
<ul>
<li><a href="https://cmake.org/download/" target="_blank">CMake</a> (3.4+)</li>
<li><a href="https://developer.apple.com/xcode/" target="_blank">Xcode</a> (3.2.6+)</li>
<li>Mac OS X 10.6 SDK (can be extracted from prior versions of Xcode; <a href="https://developer.apple.com/download/more/" target="_blank">here</a> - requires login)<ol type="a">
<li>Download Xcode 4.3.3</li>
<li>Mount the DMG file</li>
<li>Navigate to <b>Xcode.app</b> </li>
<li>Open the application bundle; choose <b>Show Package Content</b> from the context menu</li>
<li>Navigate to <b>/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs</b></li>
<li>Copy the <b>MacOSX10.6.sdk</b> folder</li>
</ol>
</li>
</ul>
<h3>Installing Mac OS X 10.6 SDK on a newer version of Xcode</h3>
<ol type="1">
<li>Navigate to <b>/Applications/XCode.app</b></li>
<li>Open the application bundle; choose <b>Show Package Content</b> from the context menu</li>
<li>Navigate to <b>/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs</b></li>
<li>Paste the <b>MacOSX10.6.sdk</b> folder</li>
<li>Navigate to <b>/Contents/Developer/Platforms/MacOSX.platform/Info.plist</b></li>
<li>Change <b>MinimumSDKVersion</b> to <b>10.6</b> <ul>
<li>You may have to copy <b>Info.plist</b> outside of the <b>XCode.app</b> folder, edit it, and then copy it back into place</li>
</ul>
</li>
<li>Restart Xcode<ul>
<li>Mac OS X 10.6 SDK should now be available for selection and building</li>
</ul>
</li>
</ol>
<p>&nbsp;</p>
<h2>Generating Apple Xcode project files:</h2>
<p><b>Note:</b> <em>In the descriptions that follow, <b><em><a href="../" target="_blank">install_dir</a></em></b> is used to mean the path of the "DAZ Studio &lt;version&gt; SDK" folder within the folder that you installed the SDK to. The instructions below describe the steps to build 64-bit versions of a plugin. To build 32-bit versions, substitute "64" with "32" and "x86_64" with "i386" where appropriate.</em></p>
<h3>Included Samples:</h3>
<ol type="1">
<li>Create a directory named <b>build</b> within <b><em><a href="../" target="_blank">install_dir</a></em></b></li>
<li>Create a directory named <b>64</b> within <b><em><a href="../build" target="_blank">install_dir/build</a></em></b></li>
<li>Launch CMake</li>
<li>Use the <b>Browse Source...</b> button to select <b><em><a href="../" target="_blank">install_dir</a></em></b></li>
<li>Use the <b>Browse Build...</b> button to select <b><em><a href="../build/64" target="_blank">install_dir/build/64</a></em></b></li>
<li>Click <b>Add Entry</b><ol type="a">
<li>Enter <b>CMAKE_OSX_ARCHITECTURES</b> for the <b>Name</b> </li>
<li>Set <b>Type</b> to <b>STRING</b> </li>
<li>Enter <b>x86_64</b> for the <b>Value</b> </li>
<li>Click the <b>OK</b> button</li>
</ol>
</li>
<li>Click the <b>Configure</b> button<ol type="a">
<li>Select <b>Xcode</b> for the generator</li>
<li>Select <b>Use default native compilers</b></li>
<li>Click the <b>Done</b> button<ul>
<li>It may take a little while to process</li>
</ul>
</li>
</ol>
</li>
<li>Enter the path to the <b>DAZ_STUDIO_EXE_DIR</b>, under the <b>Value</b> column<ul>
<li>Use the <b>...</b> button to select the installation directory of your Daz Studio installation</li>
</ul>
</li>
<li>Click the <b>Generate</b> button</li>
<li>Close CMake</li>
<li>Open the generated <b><em><a href="../build/64/DAZ Studio SDK.xcodeproj" target="_blank">install_dir/build/64/DAZ Studio SDK.xcodeproj</a></em></b> file in Xcode.</li>
</ol>
<p>&nbsp;</p>
<h3>Adding Your Own Plugins:</h3>
<ol type="1">
<li>Create a directory named <b>My Plugins</b> within <b><em><a href="../" target="_blank">install_dir</a></em></b>, as a sibling to the <b>samples</b> directory</li>
<li>Edit the <b><em><a href="../CMakeLists.txt" target="_blank">CMakeLists.txt</a></em></b> file in the <b><em><a href="../" target="_blank">install_dir</a></em></b> directory<ol type="a">
<li>Uncomment the <code>#add_subdirectory("My Plugins")</code> line directly below <code>add_subdirectory(samples)</code>, near the bottom</li>
</ol>
</li>
<li>Copy the <b>CMakeLists.txt</b> file in the <b><em><a href="../samples" target="_blank">install_dir/samples</a></em></b> directory to the <b><em><a href="../My Plugins" target="_blank">install_dir/My Plugins</a></em></b> directory</li>
<li>Create a directory named <b>plugin_name</b> within <b><em><a href="../My Plugins" target="_blank">install_dir/My Plugins</a></em></b></li>
<li>Edit the <b><em><a href="../My Plugins/CMakeLists.txt" target="_blank">CMakeLists.txt</a></em></b> file in the <b><em><a href="../My Plugins" target="_blank">install_dir/My Plugins</a></em></b> directory<ol type="a">
<li>Comment (or remove) each of the <code>add_subdirectory(&lt;folder_name&gt;)</code> statements except for one</li>
<li>Replace the remaining <code>add_subdirectory(&lt;folder_name&gt;)</code> with <code>add_subdirectory(plugin_name)</code><ul>
<li>If <b>plugin_name</b> contains spaces, enclose it in quotes</li>
</ul>
</li>
</ol>
</li>
<li>Copy the contents of the <b><em><a href="../samples/interface/AFirstPlugin" target="_blank">install_dir/samples/interface/AFirstPlugin</a></em></b> directory to the <b><em><a href="../My Plugins/plugin_name" target="_blank">install_dir/My Plugins/plugin_name</a></em></b> directory</li>
<li>Edit the <b><em><a href="../My Plugins/plugin_name/CMakeLists.txt" target="_blank">CMakeLists.txt</a></em></b> file in the <b><em><a href="../My Plugins/plugin_name" target="_blank">install_dir/My Plugins/plugin_name</a></em></b> directory<ol type="a">
<li>Rename the <code>sdk_afirstplugin</code> value in the <code>set(DZ_PLUGIN_TGT_NAME sdk_afirstplugin)</code> line near the top to the basename of the .dylib for your plugin</li>
<li>Rename the <code>"A First Plugin"</code> value in the <code>set(DZ_PLUGIN_PROJECT_NAME "A First Plugin")</code> line below it to the title of your plugin</li>
<li>Replace occurrences of <code>SDK Samples</code> with <code>My Plugins</code></li>
</ol>
</li>
<li>Repeat steps 3-11 in the <b>Included Samples</b> section above<ul>
<li>Sub-steps will not be necessary to repeat</li>
</ul>
</li>
</ol>
<p>&nbsp;</p>
<h2>Other Considerations:</h2>
<p>If you choose to forego using the provided CMake configuration files, there are several things you must be aware of and account for when building your project files.</p>
<h3>Include Directories:</h3>
<p>All the header files necessary for using the DAZ Studio SDK can be found in the <b><em><a href="../include" target="_blank">install_dir/include</a></em></b> folder. You will need to add this folder to the include paths for your plugin in order to use the DAZ Studio SDK.</p>
<p>&nbsp;</p>
<h3>Library Directories:</h3>
<p>All the *.dylib and *.framework files necessary for linking against the DAZ Studio SDK can be found in the <b><em><a href="../lib" target="_blank">install_dir/lib</a></em></b> folder; Mac32 for 32-bit plugins, Mac64 for 64-bit plugins. You will need to add this folder to the library paths for your plugin in order to use the DAZ Studio SDK.</p>
<p>&nbsp;</p>
<h3>Binary Directories:</h3>
<p>Executable and *.dylib files needed when using the DAZ Studio SDK can be found in the <b><em><a href="../bin" target="_blank">install_dir/bin</a></em></b> folder; Mac32 for 32-bit plugins, Mac64 for 64-bit plugins. You may need to add this folder to the paths that your IDE uses for finding executable files used during a build step.</p>
<p>&nbsp;</p>
<h3>Exported Symbols:</h3>
<p>By default the Xcode compiler will export all the symbols defined in a dynamic library. However, only two symbols should be exported in a DAZ Studio plugin: getSDKVersion and getPluginDefinition. The <b>Exported Symbols File</b> build setting should be used to set up what symbols are exported. A file called "exportedPluginSymbols.txt", is included in the SDK,in the "include" folder. Use this file in the <b>Exported Symbols File</b> setting as shown below. See <a class="el" href="pluginarch.html">DAZ Studio Plugin Architecture</a> for more details.</p>
<ul>
<li><b>Exported Symbols File:</b> <em>$DAZSTUDIO</em>/include/exportedPluginSymbols.txt</li>
</ul>
<p>&nbsp;</p>
<h3>The MOC (Meta-Object Compiler) pre-compiler:</h3>
<p>The DAZ Studio SDK relies on a custom pre-compiler to generate source for the Run-Time Type Information (RTTI) that the plugin architecture relies on. If you have never used a pre-compiler in your build process before, this step will be new to you, but should not be too difficult. The pre-compiler is the <b>moc.app</b> executable that can be found in the <b><em><a href="../bin" target="_blank">install_dir/bin</a></em></b> folder; Mac32 for 32-bit plugins, Mac64 for 64-bit plugins. The 'moc' utility takes 2 parameters, the path of the source file and the path of the output file. The source file will typically be a *.h file, though *.cpp files can also be "moc'ed". The output should typically be given a *.cpp extension. You can execute moc with a command such as this: <b>moc myclass.h -o myclass_moc.cpp</b>, where <b>myclass.h</b> is the source file, and <b>myclass_moc.cpp</b> is the output file generated by the moc tool. Moc can be run from Terminal using the example given above, however, this is cumbersome - every time the source file changes, it must be run through the pre-compiler again. Most developers will find that the easiest way to run moc is to make it a part of the build process by creating custom build steps for the source files in their project settings.</p>
<p>For a brief description of moc and its options, pull up Terminal and run <code>moc -help</code></p>
<p>&nbsp;</p>
<h3>Using MOC:</h3>
<p>In Xcode, the best way to use MOC without having to use a terminal each and every time for each file is to add a rule set to your target info. We want to define a shell script that gets run for files with a certain extension. Select the target name under <b>Targets</b>, then open the <b>Info</b> properties (either through the icon on the toolbar or <b>CTRL+click &gt; Get Info</b> on the project name). Select <b>Rules</b>, and then add a new rule (by clicking the + icon at the bottom of the window.) In this new rule set, Change the <b>Process</b> to <b>Source files with names matching:.</b> Change <b>using</b>: to <b>Custom Script</b>. Go back up and add the characters <b>*\.h</b> into the field on the right-hand side of the <b>Process</b>: menu. In the field just below <b>using</b>: , add the following script:</p>
<p>#!/bin/bash </p>
<p><em>$DAZSTUDIO</em>/bin/Mac32/moc <em>$INPUT_FILE_PATH</em> -o <em>$DERIVED_FILE_DIR</em>/<em>$CURRENT_ARCH</em>/moc_<em>$INPUT_FILE_BASE</em>.cpp</p>
<p>In the field under <b>with output files</b>:, Click the + button and enter the following information in the field above it:</p>
<p><em>$(</em><em>DERIVED_FILE_DIR)</em>/<em>$(</em><em>CURRENT_ARCH)</em>/moc_<em>$(</em><em>INPUT_FILE_BASE)</em>.cpp</p>
<p>Notice that for the shell script, variable names are not enclosed in parentheses, but in the output file entry, parentheses are needed. The <em>$DAZSTUDIO</em> variable is discussed above, and the <em>$INPUT_FILE_PATH</em>, <em>$INPUT_FILE_BASE</em>, <em>$DERIVED_FILE_DIR</em>, and <em>$CURRENT_ARCH</em> are built-in Xcode variables. You could modify the above script by removing the <em>$DAZSTUDIO</em> variable and using the absolute path to the location of the moc executable, but the above method insures portability between computers, as well as between developers if the project is collaborative. The other variables are needed so that individual files will be processed correctly.</p>
<p>Now we have set up a rule that tells Xcode to run the above shell script on files with a ".h" extension. If we define the output file, then Xcode automatically compiles that output file and uses it for the target.</p>
<p><b>Important:</b> When using this method, you need to add the header files which require MOC pre-compiling into the target for your plugin as source files (put them in <b>Targets &gt; (Project Name) &gt; Compile Sources</b>) or else the rule we defined will not be applied, and the build will fail with "Undefined Symbol" errors. At this point, Xcode will automatically preprocess all header files found within (Project Name) &gt; Source with moc, and generate corresponding <b>moc_&lt;original file name&gt;.cpp</b> files which are then compiled and linked along with other source files.</p>
<p>&nbsp;</p>
<h3>When to use MOC (and when not to):</h3>
<p>Not all files for a DAZ Studio plugin need to be processed by the precompiler. Only files which declare <a class="el" href="class_dz_base.html" title="Base class for a considerable portion of the Daz Studio API.">DzBase</a> (or QObject) derived classes need to be moc'ed; if your source file uses the 'Q_OBJECT' macro anywhere, then it needs to be moc'ed. Otherwise, the precompiler step is unnecessary. See the example plugins included in the SDK to see how the 'moc' build step is set up. </p>
</div>
<hr size="1">
<address style="align: right;">
<small> Generated on Sun Feb 9 2020 01:35:17</small>
</address>
<h3 align="center">Copyright &copy; 2002 - 2020 DAZ 3D, Inc.</h3>
</body>
</html>
